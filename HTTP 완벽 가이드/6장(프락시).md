## 프락시

프락시는 클라이언트와 서버사이의 메세지 전달을 담당하는 중개인 역할을 한다.

기존에는(프락시를 사용하기 전) 클라이언트가 서버와 직접적으로 메세지를 주고받았는데(HTTP 트랜잭션을 수행하였는데), 프락시를 두게되면
클라이언트는 프락시와 소통하며, 서버도 프락시와 소통하게 된다. 

즉, 클라이언트는 요청 메세지를 프락시에게 전달하고 프락시는 그 메세지를 서버에게 전달하여, 서버는 응답메세지를 프락시에게 주고 프락시는 그 메세지를 
클라이언트에게 전달한다.

### 프락시 사용시 장점

- 비용감소
- 성능향상
- 보안증가
- 트래픽 감시 및 수정가능

### 프락시의 예

- `방화벽 프락시`
  - EX) 초등학생들이 학교에서 컴퓨터 사용시 성인 사이트를 방문하지 못하도록 막는것
- `웹 캐싱 프락시`
  - EX) 클라이언트 A와 B가 있는데 B는  index.html 리소스를 원 서버에서 접근하여 가져오는 반면 A는 리소스를 웹 캐시 프락시에서 접근하여 가져온다.
- `대리 프락시(리버스 프락시, 서버 가속기)`
  - 진짜 웹 서버 요청을 받지만, 웹 서버와는 달리 요청 받은 콘텐츠의 위치를 찾아내기 위해 다른 서버와 소통한다.
  - 공용 콘텐츠에 대한 느린 웹 서버의 성능을 개선하기 위해 사용될 수 있다.
- `콘텐츠 라우터`
  - 인터넷 트래픽 조건과 콘텐츠의 종류에 따라 요청을 특정 웹서버로 유도하게 할 수 있다.
  - EX) 사용자 A와 B가 있을 때, 사용자 A는 더 높은 성능을 위해 돈을 지불한 경우, 콘텐츠 라우터가 A의 요청을 웹 캐싱 프락시로 보낸다.
  - 사용자 B는 돈을 지불하지 않아서, 콘텐츠 라우터가 B의 요청을 원 서버로 보낸다.
- `트랜스코딩 프락시`
  - 크기를 줄이기 위해서 자신을 거쳐가는 GIF 이미지를 JPG로 변환할 수 있다.
  - 한국어 텍스트를 스페인어 텍스트로 변환할 수 있다.
  - HTML을 단순한 텍스트로 변환할 수 있다.
- `익명화 프락시`
  - 익명화 프락시는 HTTP 메세지에서 신원을 식별할 수 있는 특성들(IP주소, FROM 헤더, Referer 헤더, 쿠키, URI 세션 아이디)을 적극적으로 제거함으로써
  개인정보보호와 익명성 보장에 기여한다.
  - EX) User-Agent 헤더에서 사용자의 컴퓨터와 OS종류를 제거한다.
  - EX) 사용자의 이메일 주소를 보호하기 위해 FROM 헤더는 제거된다.
  - EX) 어떤 사이트를 거쳐서 방문했는지 알기 어렵게 하기 위해 Referer 헤더는 제거된다.
  - EX) 프로필과 신원 정보를 없애기 위해서 Cookie 헤더는 제거된다.
  
  ### 프락시 서버 배치 방법
  
  - `출구(Egress) 프락시`
    - 로컬 네트워크와 더 큰 인터넷 사이를 오가는 트래픽을 제어하기 위해서 프락시를 로컬 네트워크의 출구에 박아 넣을 수 있다.
    - EX) 회사 밖의 악의적인 해커들을 막는 방화벽 제공을 위해
    - EX) 초등학교에서 학생들이 부적절한 컨텐츠를 브라우징 하는 것을 막기 위해
  - `접근(입구) 프락시`
    - 고객으로부터의 모든 요청을 종합적으로 처리하기 위해 프락시는 ISP 접근 지점에 위치할 수 있다.
    - ISP는 사용자들의 다운로드 속도를 개선하고, 인터넷 대역폭 비용을 줄이기 위해 캐시 프락시를 사용해 많이 찾는 문서들의 사본을 저장한다.
  - `대리(리버스) 프락시`
    - 네트워크의 가장 끝에 있는 웹 서버들의 바로 앞에 위치하여 웹 서버로 향하는 모든 요청을 처리하고 필요할 때만 웹 서버에게 자원을 요청할 수 있다.
  - `네트워크 교환 프락시`
    - 캐시를 이용해 인터넷 교차로의 혼잡을 완화하고 트래픽 흐름을 감시하기 위해, 충분한 처리 능력을 갖춘 프락시가 네트워크 사이의 인터넷 피어링 교환 지점들에 놓일수 있다.
    
### 프락시 계층

> 클라이언트 - 프락시1(프락시2의 자식) - 프락시2(프락시3의 자식, 프락시 1의 부모) - 프락시3(프락시2의 부모) - 서버

클라이언트와 가까운 프락시를 자식 프락시라하고, 서버와 가까운 프락시를 부모 프락시라한다.

## 프락시 URI와 서버 URI는 다르다

- 클라이언트가 웹 서버와 직접 HTTP 트랜잭션을 실행하는 경우
  - 부분 URI를 사용함
  - 메세지 형식은 아래와 같다.
    - GET /index.html HTTP/1.0
    - User-Agent: SuperBrowserv1.3
    
- 클라이언트가 프락시와 HTTP 트랜잭션을 실행하는 경우
  - 완전한 URI가 필요함
    - 목적지인 서버와 커넥션을 맺어야 하기 때문에 서버 이름을 알아야 한다.
    - 프락시 기반 게이트웨이는 FTP 리소스나 그 외의 스킴과 연결하기 위해서 URI 스킴을 알아야한다.
  - 메세지 형식은 아래와 같다.
    - GET http://www.mary-antiques.com/index.html HTTP/1.0
    - User-Agent: SuperBrowserv1.3
  - 인터셉트 프락시와 대리 프락시는 부분URI를 받는다.
    - 프락시를 사용한다 하더라도, 클라이언트 트래픽은 여전히 대리 프락시나 인터셉트 프락시를 지날 수 있다.
      - 두 가지 경우 모두, 클라이언트 자신이 웹 서버와 대화하고 있다고 생각하고 완전한 URI를 보내지 않는다.

## TRACE 메서드

TRACE 메서드는 프락시 흐름을 디버깅 하는데 유용하다.

HTTP 프락시 네트워크를 통해 홉에서 홉으로 전달될 때마다 메시지의 내용이 어떻게 변하는지 관찰 할 수 있다.

요청 메세지를 프락시의 연쇄를 따라가면서 어떤 프락시를 지나가고 어떻게 각 프락시가 요청 메세지를 수정하는지 관찰/추적할 수 있다.

TRACE 요청에 목적지 ㅓ버에 도착했을 때, 서버는 전체 요청 메세지를 HTTP 응답 메세지의 본문에 포함시켜 송신자에게 그대로 돌려보낸다.
