# 클라이언트 식별과 쿠키

## 뚱뚱한 URL

사용자의 상태 정보를 포함하고 있는 URL을 뚱뚱한 URL이라고 한다.

뚱뚱한 URL의 문제점

- 못생긴 URL : 새로운 사용자들에게 혼란을 준다
- 공유하지 못하는 URL : 뚱뚱한 URL은 특정 사용자와 세션에 대한 상태 정보를 포함한다. 만약 그 주소를 누군가에게 메일로 보내면 당신의 누적된 개인 정보를
본의 아니게 공유하게 되는 것이다.
- 캐시를 사용할 수 없음
- 서버 부하 가중 : 서버는 뚱뚱한 URL에 해당하는 HTML 페이지를 다시 그려야 한다.
- 이탈 
- 세션 간 지속성의 부재

## 쿠키 

쿠키는 사용자를 식별하고 세션을 유지하는 방식 중에서 현재까지 가장 널리 사용하는 방식이다. 쿠키는 매우 중요한 웹 기술일 뿐만 아니라 새로운 HTTP 헤더를
정의한다. 쿠키는 캐시와 충돌할 수 있어서, 대부분의 캐시나 브라우저는 쿠키에 있는 내용물을 캐싱하지 않는다.

쿠키는 크게 `세션 쿠키(session cooke)`와 지속 쿠키(persistent cookie)` 두 가지 타입으로 나눌 수 있다.

- 세션 쿠키
  - 사용자가 사이트를 탐색할 때, 관련한 설정과 선호 사항들을 저장하는 임시 쿠키
  - 브라우저를 닫으면 삭제된다.
- 지속 쿠키
  - 세션 쿠키보다 삭제되지 않고 더 길게 유지할 수 있다.
  - 디스크에 저장되여, 브라우저를 닫거나 컴퓨터를 재시작하더라도 남아있다.
  - 지속 쿠키는 사용자가 주기적으로 방문하는 사이트에 대한 설정 정보나 로그인 이름을 유지하려고 사용한다.
  
> 세션 쿠키와 지속 쿠키의 차이점은 파기되는 시점뿐이다. 쿠키는 `Discard` 파라미터가 설정되어 있거나, 파기되기까지 남은 시간을 가리키는 `Expires` 혹은
`Max-Age` 파라미터가 없으면 세션 쿠기가 된다.

두문자 암기 : DEM(Discard, Expires, Max-Age)

쿠키는 임의의 이름=값 형태의 리스트를 가지고, 그 리스트는 Set-Cookie 혹은 Set-Cookie2(확장 헤더) 같은 HTTP 응답 헤더에 기술되어 사용자에게 전달한다.

쿠키는 어떤 정보든 포함할 수 있지만, 서버가 사용자 추적 용도로 생성한 유일한 단순 식별 번호만 포함하기도 한다. 

예를들어 서버가 id=12345 라는 쿠키를 사용자에게 할당하면, 서버는 이 쿠키값으로 DB에서 사용자의 정보(구매내용, 주소정보 등)를 찾는데 사용할 수 있다.

> EX) Cookie: name="Brian Totty"; phone="555-1212"

### HTTP 상태 관리 체계(HTTP State Management Mechanism)

쿠키의 기본적인 발상은 브라우저가 서버 관련 정보를 저장하고, 사용자가 해당 서버에 접근할 때마다 그 정보를 함께 전송하는 것이다. 브라우저는
쿠키 정보를 저장할 책임이 있는데, 이 시스템을 `클라이언트 측 상태`라고하며 공식적인 이름은 `HTTP 상태 관리 체계`

구글 크롬은 `Cookies라는 SQLite` 파일에 쿠키를 저장한다.

### 브라우저가 보내는 쿠키의 갯수

브라우저는 수백 수천개의 쿠키를 가지고 있지만, 사실상 한 사이트에 보통 2~3개의 쿠키만을 보낸다. 모든 쿠키를 보내게 될경우 생기는 문제점은 아래와 같다.

- 성능 저하 : 실제 Contents 보다 Cookies의 크기가 더 크다
- 쿠키는 이름/값 형태로 서버에 특화된 형식으로 되어있어서, 대부분의 사이트에서는 무의미하다.
- 개인정보 문제를 일으킬 수 있다.

### 쿠키 Domain 속성

서버는 쿠키를 생성할 때 `Set-Cookie` 응답 헤더에 Domain 속성을 기술해서 어떤 사이트가 그 쿠키를 읽을 수 있는지 제어할 수 있다.

### 쿠키 Path 속성

웹 사이트 일부에만 쿠키를 적용할 수 도 있다.

URL 경로의 앞부분을 가리키는 Path 속서을 기술해서 해당 경로에 속하는 페이지에만 쿠키를 전달 할 수 있다.

### 쿠키와 캐시

- 캐시되지 말아야 할 문서가 있다면 표시하라

문서가 캐시하면 될지 안 될지는 문서의 소유자가 가장 잘 안다. 만약 문서가 Set-Cookie 헤더를 제외하고 캐시를 해도 될 경우라면 그 문서에 명시적으로
Cache-Control: no-cache="SetCookie"를 기술해서 명확하게 표시한다. 또한, 캐시를 해도 되는 문서에는  Cache-Control: public을 사용하면 웹의 
대역폭을 더 절약시켜준다.
